# 手办化 Pro 插件 (Figurine Era)

一个功能强大的手办化插件，融合了多个插件的优点，使用 `gcli2api` 作为后端。

**致谢:** 本插件的实现基于 `astrbot_plugin_gemini_image` (作者: Codex) 和 `astrbot_plugin_shoubanhua` (作者: shskjw) 的代码，在此表示感谢。

## 功能特性

- **多种风格转换**：内置 `/手办化`、`/手办化2`... 等多个指令，以及 `/Q版化`、`/cos化` 等数十种风格。
- **gemini cli 后端**：使用 `gemini cli` 对接 Gemini 原生接口，稳定高效。
- **指令触发**：通过 `/指令` 的方式精确调用，不支持自然语言模糊触发。
- **灵活的输入**：支持直接发送图片、回复图片、或 `@用户` 来使用其头像进行制作。
- **强大的管理功能**：内置次数限制、签到、黑白名单、自定义提示词等高级管理功能。
- **代理支持**：内置网络代理支持。

## 安装与配置

1.  将插件文件夹放入 `astrbot/plugins` 目录。
2.  在 `requirements.txt` 中添加 `httpx` 和 `aiohttp`。
3.  重启 AstrBot。
4.  在 AstrBot 管理面板的 `插件管理` -> `figurine_era` 中进行配置。

**核心配置项：**

| 配置项                  | 描述                                                                 |
| ----------------------- | -------------------------------------------------------------------- |
| `gemini_cli_base_url`     | **(必需)** gemini cli 的基础地址，例如 `http://127.0.0.1:7861`，**请勿**在末尾添加 `/v1`。 |
| `gemini_cli_api_password` | **(必需)** gemini cli 的 API 密码。                                    |
| `model_name`            | 使用的模型名称，默认为 `gemini-2.5-flash-image`。                    |

## 📖 命令列表

### 核心命令

| 命令 | 功能说明 |
| :--- | :--- |
| `/生图 <提示词>` | 纯文本生图 |
| `/改图 <提示词>` | 携带/引用图片后进行改图 |
| `/手办化` | 生成高质量手办，偏向树脂质感和摄影感 |
| `/手办化2` | 生成另一种风格的手办，偏向商业化成品和柜中展示 |
| `/手办化3` | (原手办化1) 偏向工作室和创作过程展示 |
| `/手办化4` | (原手办化2) 偏向带包装盒的成品展示 |
| `/手办化5` | (原手办化3) 强调主体识别和特征保留 |
| `/手办化6` | (原手办化4) 玻璃展示柜中的手办 |
| `/手办化7` | (原手办化5) 游戏截图风格的手办化 |
| `/手办化8` | (原手办化6) 带零售包装盒的收藏品风格 |
| `/Q版化` | 生成Q版（可爱简化比例）的角色形象 |
| `/cos化` | 生成角色cosplay化的照片风格 |
| `/cos自拍` | 生成角色自拍风格的cos照片 |
| `/痛屋化` | 生成贴满角色元素装饰的房间场景 |
| `/痛屋化2` | 生成改良版痛屋场景 |
| `/痛车化` | 生成贴有角色图案的车辆造型 |
| `/孤独的我` | 生成孤独、滑稽或小丑化的意境图 |
| `/第一视角` | 生成第一人称沉浸感场景 |
| `/第三视角` | 生成第三人称旁观感场景 |
| `/鬼图` | 生成灵异鬼图风格照片 |
| `/贴纸化` | 生成贴纸风格的小图 |
| `/玉足` | 生成角色足部特写 |
| `/玩偶化` | 生成fumo风格的毛绒玩偶 |
| `/cos相遇` | 生成coser与原作角色相遇的场景 |
| `/三视图` | 生成角色三视图 |
| `/穿搭拆解` | 生成角色服装穿搭的详细拆解图 |
| `/拆解图` | 生成模型拆解或零件展示图 |
| `/角色界面` | 生成游戏角色信息界面风格的画面 |
| `/角色设定` | 生成角色设定图 |
| `/3D打印` | 生成带3D打印机的场景 |
| `/微型化` | 生成微缩模型效果 |
| `/挂件化` | 生成挂件、钥匙扣风格 |
| `/姿势表` | 生成角色姿势参考表 |
| `/高清修复` | 对画面进行高清化、细节修复 |
| `/人物转身` | 生成人物转身动作的连续画面 |
| `/绘画四宫格` | 生成四宫格绘画过程展示 |
| `/发型九宫格` | 生成九种不同发型的对比图 |
| `/头像九宫格` | 生成九个不同风格的头像合集 |
| `/表情九宫格` | 生成角色九种不同表情合集 |
| `/多机位` | 生成多机位拍摄的场景视角合集 |
| `/电影分镜` | 生成电影风格的分镜图 |
| `/动漫分镜` | 生成动漫风格的分镜图 |
| `/真人化` | 生成角色的真人化形象 |
| `/真人化2` | 生成另一种风格的真人化形象 |
| `/半真人` | 生成半写实半动漫的混合风格 |
| `/半融合` | 生成角色与其他元素融合的半融合风格 |
| `/bnn <提示词>` | 使用完全自定义的提示词进行创作 |
| `/lm帮助` | 查看所有可用的指令和提示词 |

### 管理命令 (仅主人)

| 命令 | 功能说明 |
| :--- | :--- |
| `/lm添加` | 动态添加或修改指令和提示词 |
| `/手办化增加用户次数` | 为用户增加使用次数 |
| `/手办化增加群组次数` | 为群组增加使用次数 |
| `/手办化查询次数` | 查询自己或指定用户的次数（所有用户均可使用） |
| `/手办化添加key` | 添加API密钥 |
| `/手办化key列表` | 查看所有API密钥 |
| `/手办化删除key` | 删除指定的API密钥 |
| `/手办化签到` | 每日签到获取免费次数 |

---

## 版本历史

- **v1.0.6**: 重构并优化了 API 调用逻辑，采用流式优先、失败后自动回退到非流式的策略，显著提升了响应速度和成功率。修复了 API 调用后可能出现的“文件未找到”错误。
- **v1.0.5**: 删除了"手办化开启签到"和"手办化关闭签到"命令，签到功能只能通过插件设置控制。
- **v1.0.3**: 添加了生图和改图功能，修复了lm帮助和lm添加命令。
- **v.1.0.2**: 修复了事件处理优先级问题，确保插件功能正常工作。
- **v1.0**: 基于 `astrbot_plugin_shoubanhua` 和 `astrbot_plugin_gemini_image` 进行重构，统一使用 `gemini cli` 后端，并整合了指令和功能。

## 许可证

MIT License

---

## 支持作者

如果您觉得这个插件有用，不妨去 [GitHub 仓库](https://github.com/EraAsh/astrbot_plugin_figurine_era) 点个 Star 吧！您的支持是我更新的最大动力！